<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="第7讲 隐蔽的恶意代码启动_带实验">
<meta property="og:type" content="article">
<meta property="og:title" content="隐蔽的恶意代码启动_带实验">
<meta property="og:url" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/index.html">
<meta property="og:site_name" content="LUOSY&#39;S BLOG">
<meta property="og:description" content="第7讲 隐蔽的恶意代码启动_带实验">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124104813312.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105156503.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105255408.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105308980.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105334218.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105341300.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105633344.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124111610569.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124111621291.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124111826284.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124112334198.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124112550391.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124112732632.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201102928314.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201103203535.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201103718393.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201104641285.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201105132206.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201105514092.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201105902159.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201111832273.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201112100947.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201112308217.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201112839606.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201113823781.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201114243389.png">
<meta property="og:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124114657979.png">
<meta property="article:published_time" content="2022-11-24T02:41:10.000Z">
<meta property="article:modified_time" content="2022-12-01T08:54:50.000Z">
<meta property="article:author" content="LUOSY">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124104813312.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://luosyrrrr.github.io/2022/11/24/恶意代码/隐蔽的恶意代码启动-带实验/"/>





  <title>隐蔽的恶意代码启动_带实验 | LUOSY'S BLOG</title>
  








<meta name="generator" content="Hexo 6.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LUOSY'S BLOG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Cyber security->AI</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luosyrrrr.github.io/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LUOSY'S BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">隐蔽的恶意代码启动_带实验</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-11-24T10:41:10+08:00">
                2022-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/" itemprop="url" rel="index">
                    <span itemprop="name">恶意代码</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
              <div class="post-description">
                  第7讲 隐蔽的恶意代码启动_带实验
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>隐蔽的恶意代码启动</strong></p>
<h1 id="1-启动器（Launcher）"><a href="#1-启动器（Launcher）" class="headerlink" title="1 启动器（Launcher）"></a>1 启动器（Launcher）</h1><p><strong>启动器</strong>：也称为加载器，用来启动其他恶意程序的恶意代码。通常情况下，启动器使用一些非传统的技术，来启动其他恶意程序。</p>
<p><strong>目的</strong>：</p>
<blockquote>
<p>使恶意行为对用户隐藏；<br>可能包含提权代码，以更高权限访问系统。</p>
</blockquote>
<p><strong>启动器+恶意代码</strong></p>
<img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124104813312.png" alt="image-20221124104813312" style="zoom:33%;">

<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105156503.png" alt="image-20221124105156503"></p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105255408.png" alt="image-20221124105255408"></p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105308980.png" alt="image-20221124105308980"></p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105334218.png" alt="image-20221124105334218"></p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105341300.png" alt="image-20221124105341300"></p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124105633344.png" alt="image-20221124105633344"></p>
<h1 id="2-进程注入"><a href="#2-进程注入" class="headerlink" title="2 进程注入"></a>2 进程注入</h1><p>进程注入是隐藏启动的最流行的技术。<br><strong>进程注入</strong>：这种技术是将代码注入到另外一个正在运行的进程中，而被注入的进程会不知不觉地运行注入的代码。</p>
<p><strong>常用函数</strong>：</p>
<blockquote>
<p>VirtualAllocEx：在指定进程中分配一块内存空间<br>WriteProcessMemory：此函数能写入某一进程的内存区域(由VirtualAllocEx分配)</p>
</blockquote>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124111610569.png" alt="image-20221124111610569"></p>
<p>进程注入实现过程</p>
<img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124111621291.png" alt="image-20221124111621291" style="zoom:33%;">

<img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124111826284.png" alt="image-20221124111826284" style="zoom: 33%;">

<blockquote>
<ol>
<li><p>FindWindow( )、GetWindowThreadProcessId( )&#x2F; CreateToolhelp32Snapshot( )，Process32First( )和Process32Next( )这两组函数就是为了获得目标进程的ID，OpenProcess( )这个API实现打开进程。</p>
</li>
<li><p>VirtualAllocEx( )向“宿主进程”申请内存。</p>
</li>
<li><p>WriteProcessMemory( )把特定的数据（恶意DLL模块或恶意代码）写进“目标进程”。</p>
</li>
<li><p>GetProcAddress( )检索指定的动态链接库(DLL)中的输出库函数（LoadLibrary）地址。LoadLibrary( )是加载DLL文件的必备API。</p>
</li>
<li><p>CreateRemoteThread( )或者NtCreateThreadEx ( )或RtlCreateUserThread ( ) ，这个API强制在宿主进程里面新建一个线程。</p>
</li>
<li><p>WaitForSingleObject( )、VirtualFreeEx( )、CloseHandle( )等待与清理。</p>
</li>
</ol>
</blockquote>
<h2 id="2-1-DLL-注入"><a href="#2-1-DLL-注入" class="headerlink" title="2.1 DLL 注入"></a>2.1 DLL 注入</h2><p><strong>定义</strong>：DLL注入是进程注入的一种形式，它强迫一个远程进程加载恶意DLL程序，同时它是最常用的秘密加载技术。<br>            所谓DLL注入就是将一个DLL放进某个进程的地址空间里，让它成为那个进程的一部分。</p>
<p><strong>实现</strong>：</p>
<blockquote>
<p>DLL注入是令远程线程载入一个恶意的DLL，通过DllMain( )函数执行需要的代码。<br>基本思路是将LoadLibrary()函数作为一个线程函数来调用：</p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124112334198.png" alt="image-20221124112334198"></p>
</blockquote>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124112550391.png" alt="image-20221124112550391"></p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124112732632.png" alt="image-20221124112732632"></p>
<h2 id="2-2-直接注入"><a href="#2-2-直接注入" class="headerlink" title="2.2 直接注入"></a>2.2 直接注入</h2><p><strong>相同点</strong><br>       同DLL注入一样，在远程进程的内存空间中分配和插入代码，使用类似的Windows函数。<br><strong>不同点</strong><br>       不单独编写DLL，直接将恶意代码注入到远程进程中，比DLL注入更加灵活。</p>
<p><strong>特点</strong></p>
<blockquote>
<p>需要大量的定制代码<br>通常用来注入shellcode<br>两次VirtualAllocEx()和WriteProcessMemory()<br>要求精通汇编语言，或编写简单的shellcode</p>
</blockquote>
<h1 id="3-进程替换"><a href="#3-进程替换" class="headerlink" title="3 进程替换"></a>3 进程替换</h1><p><strong>定义</strong><br>       进程替换是指将正在运行的程序的内存空间用恶意代码替换掉。如果被替换的进程是合法的进程, 那么恶意代码可以披着合法的外衣干坏事。<br><strong>关键点</strong></p>
<blockquote>
<p>以挂起状态创建一个进程。 </p>
<p>CreateProcess以CREATE_SUSPENDED方式调用。</p>
</blockquote>
<p>线程状态：睡眠、阻塞、挂起、运行</p>
<blockquote>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201102928314.png" alt="image-20221201102928314"></p>
</blockquote>
<p>进程替换过程</p>
<blockquote>
<p>1.创建一个<strong>挂起状态</strong>的进程, 此时进程的主线程还未开始运行；<br>2.读取主线程的<strong>上下文</strong>, 并读取新创建进程的基址；<br>3.使用<strong>ZwUnmapViewOfSection</strong>&#x2F;<strong>NtUnmapViewOfSection</strong>将新创建的进程的内存空间释放掉, 随后可以开始填充恶意代码；<br>4.用<strong>VirtualAllocEx</strong>在子进程指定的基址分配空间，调用<strong>ReadProcessMemory</strong>和<strong>WriteProcessMemory</strong>来读写子进程空间的内容，调用<strong>VirtualProtectEx</strong>修改内存的属性为可读可写可执行；<br>5.设置主线程的上下文, <strong>启动</strong>主线程。</p>
</blockquote>
<p>进程替换伪代码</p>
<img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201103203535.png" alt="image-20221201103203535" style="zoom: 67%;">

<h1 id="4-钩子（Hook）注入"><a href="#4-钩子（Hook）注入" class="headerlink" title="4 钩子（Hook）注入"></a>4 钩子（Hook）注入</h1><p>钩子(Hook)，是Windows<strong>消息处理机制</strong>的一个平台，应用程序可以在上面设置子程以监视指定窗口的某种消息，而且所监视的窗口可以是<strong>其他进程</strong>所创建的。当消息到达后，在目标窗口处理函数之前处理它。钩子机制允许应用程序<strong>截获处理</strong>Window消息或特定事件</p>
<p>钩子实际上是一个<strong>处理消息的程序段</strong>，<strong>通过系统调用</strong>，<strong>把它挂入系统</strong>。每当特定的消息发出，在没有到达目的窗口前，钩子程序就先捕获该消息，亦即<strong>钩子函数先得到控制权</strong>。这时钩子函数即可以加工处理（改变）该消息，也可以不作处理而继续传递该消息，还可以强制结束消息的传递。</p>
<p>没有使用钩子注入和使用钩子注入的Windows事件和消息流</p>
<img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201103718393.png" alt="image-20221201103718393" style="zoom: 67%;">



<h2 id="4-1钩子的分类"><a href="#4-1钩子的分类" class="headerlink" title="4.1钩子的分类"></a>4.1钩子的分类</h2><p>按使用范围分类</p>
<blockquote>
<p><strong>系统钩子</strong>（全局钩子）</p>
<ul>
<li>监视系统中的<strong>所有线程</strong>的事件消息。</li>
<li>会影响系统中<strong>所有应用程序</strong>，钩子函数必须放在独立的动态链接库(DLL)中。</li>
<li>系统自动将包含“钩子回调函数”的DLL映射到受<strong>钩子函数</strong>影响的所有进程的<strong>地址空间</strong>中，即将这个DLL注入到那些进程。</li>
</ul>
<p><strong>线程钩子</strong>（局部钩子）</p>
<ul>
<li>用于监视<strong>指定线程</strong>的事件消息。</li>
<li>一般在<strong>当前线程</strong>或者当前线程<strong>派生的线程内</strong>。</li>
</ul>
</blockquote>
<p>按事件分类</p>
<blockquote>
<p>（1）键盘钩子和低级键盘钩子可以监视各种<strong>键盘</strong>消息。<br>（2）鼠标钩子和低级鼠标钩子可以监视各种<strong>鼠标</strong>消息。<br>（3）外壳钩子可以监视各种<strong>Shell事件</strong>消息。比如：启动和关闭应用程序。<br>（4）日志钩子可以记录从系统消息队列中取出的各种<strong>事件</strong>消息。<br>（5）窗口过程钩子监视所有从系统消息队列发往<strong>目标窗口</strong>的消息。<br>（6）还有一些<strong>特定事件</strong>的钩子。</p>
</blockquote>
<h2 id="4-2-系统和线程钩子（Hook）"><a href="#4-2-系统和线程钩子（Hook）" class="headerlink" title="4.2 系统和线程钩子（Hook）"></a>4.2 系统和线程钩子（Hook）</h2><p>**SetWindowsHookEx()**函数的最后一个参数，决定此钩子是系统钩子还是线程钩子。</p>
<p>如果对同一事件（如鼠标消息）<strong>既安装线程钩子又安装系统钩子</strong>，那么系统会自动<u>先调用线程钩子，然后调用系统钩子</u>。</p>
<p>对同一事件消息可安装<strong>多个</strong>钩子处理过程，这些钩子处理过程形成钩子链。当前钩子处理结束后，应把钩子信息传递给下一个钩子函数。</p>
<p>钩子特别是系统钩子会消耗消息处理时间，<strong>降低系统性能</strong>。只有在必要的时候才安装钩子，在使用完毕后<strong>要及时卸载</strong>。</p>
<h2 id="4-3-使用钩子的键盘记录器"><a href="#4-3-使用钩子的键盘记录器" class="headerlink" title="4.3 使用钩子的键盘记录器"></a>4.3 使用钩子的键盘记录器</h2><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201104641285.png" alt="image-20221201104641285" style="zoom: 50%;">





<h2 id="4-4-使用SetWindowsHookEx"><a href="#4-4-使用SetWindowsHookEx" class="headerlink" title="4.4 使用SetWindowsHookEx"></a>4.4 使用SetWindowsHookEx</h2><p><strong>函数功能</strong><br>       该函数将一个应用程序定义的<strong>挂钩处理过程</strong>安装到挂钩链中，可以通过安装<strong>挂钩处理过程</strong>来对系统的某些类型事件进行<strong>监控</strong>，这些事件与某个特定的<strong>线程或系统</strong>中的所有事件相关。</p>
<p><strong>函数原型</strong>：</p>
<img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201105132206.png" alt="image-20221201105132206" style="zoom: 33%;">

<p><strong>参数</strong>：</p>
<p><strong>idHook</strong>：指示欲被安装的挂钩处理过程的<strong>类型</strong>。（14种）<br><strong>lpfn</strong>：指向相应的<strong>挂钩处理过程</strong>。若参数dwThreadId为0或者指示一个其他进程创建的线程的标识符，则参数lpfn必须指向一个动态链接中的挂钩处理过程。否则，参数lpfn可以指向一个与当前进程相关的代码中定义的挂钩处理过程。<br><strong>hMod</strong>：指示一个<strong>动态链接库的句柄</strong>，该动态连接库包含参数lpfn所指向的挂钩处理过程。若参数dwThreadId指示的线程由当前进程创建，并且相应的挂钩处理过程定义于当前进程相关的代码中，则参数hMod必须被设置为NULL(0)。<br><strong>dwThreadId</strong>：指示一个<strong>线程标识符</strong>，挂钩处理过程与线程相关（线程钩子）。若此参数值为0，则该挂钩处理过程与所有现存的线程相关。（系统钩子）</p>
<p><strong>例子</strong>：</p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201105514092.png" alt="image-20221201105514092"></p>
<img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201105902159.png" alt="image-20221201105902159" style="zoom: 50%;">

<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1199648">https://cloud.tencent.com/developer/article/1199648</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/a1286160028/article/details/86571914?spm=1001.2101.3001.6650.4&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-4.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-4.no_search_link">https://blog.csdn.net/a1286160028/article/details/86571914?spm=1001.2101.3001.6650.4&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-4.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-4.no_search_link</a></p>
<h2 id="4-5-目标线程"><a href="#4-5-目标线程" class="headerlink" title="4.5 目标线程"></a>4.5 目标线程</h2><p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201111832273.png" alt="image-20221201111832273"></p>
<h1 id="5-Detours"><a href="#5-Detours" class="headerlink" title="5 Detours"></a>5 Detours</h1><p>简介（<a target="_blank" rel="noopener" href="https://github.com/microsoft/detours%EF%BC%89">https://github.com/microsoft/detours）</a></p>
<p>Detours是一个在x86、x64、IA64和ARM64平台上<strong>截获</strong>任意API函数调用的工具库。</p>
<p>Detours使用一个<strong>无条件转移指令</strong>来替换目标函数的最初几条指令，将控制流转移到一个用户提供的截获函数。</p>
<p>目标函数中的一些指令被保存在一个被称为“<strong>trampoline</strong>”的函数中。</p>
<p>这些指令包括目标函数中被替换的代码，以及一个重新跳转到目标函数的无条件分支。而截获函数可以替换目标函数，或者通过执行“trampoline”函数的时候，将目标函数作为子程序来调用的办法来扩展功能。</p>
<p><strong>例子</strong>：</p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201112100947.png" alt="image-20221201112100947"></p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201112308217.png" alt="image-20221201112308217"></p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201112839606.png" alt="image-20221201112839606"></p>
<h1 id="6-APC-注入"><a href="#6-APC-注入" class="headerlink" title="6 APC 注入"></a>6 APC 注入</h1><p> APC：异步过程调用<br> APC模式：内核模式、用户模式<br> APC注入的原理：是利用当线程被唤醒时，APC中的注册函数会被执行的机制，并以此去执行DLL加载代码，进而完成DLL注入的目的。</p>
<h2 id="6-1-APC注入用户模式APC注入流程"><a href="#6-1-APC注入用户模式APC注入流程" class="headerlink" title="6.1 APC注入用户模式APC注入流程"></a>6.1 APC注入用户模式APC注入流程</h2><p>1.当EXE里某个线程执行到SleepEx( )或者WaitForSingleObjectEx()时，系统就会产生一个软中断。</p>
<p>2.当线程再次被唤醒时，此线程会首先执行<strong>APC</strong>队列中的被注册的函数。</p>
<p>3.利用<strong>QueueUserAPC()<strong>这个API可以在软中断时，向线程的</strong>APC</strong>队列插入一个函数指针，如果插入的是<strong>Loadlibrary( )<strong>执行函数的话，</strong>就能达到注入DLL</strong>的目的。</p>
<img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201113823781.png" alt="image-20221201113823781" style="zoom:67%;">



<h2 id="6-2-内核模式的APC-注入"><a href="#6-2-内核模式的APC-注入" class="headerlink" title="6.2 内核模式的APC 注入"></a>6.2 内核模式的APC 注入</h2><p>1.设备驱动函数主要利用两个函数：KeInitializeAPC和KeInsertQueueAPC。</p>
<p>2.KeInitializeAPC初始化一个KAPC结构，传递参数给KeInsertQueueAPC，将APC对象放到目标线程相应的APC队列中 。</p>
<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221201114243389.png" alt="image-20221201114243389"></p>
<h1 id="平时作业"><a href="#平时作业" class="headerlink" title="平时作业"></a>平时作业</h1><h2 id="一、查阅资料，实现直接注入和DLL注入。"><a href="#一、查阅资料，实现直接注入和DLL注入。" class="headerlink" title="一、查阅资料，实现直接注入和DLL注入。"></a>一、查阅资料，实现直接注入和DLL注入。</h2><p>打印hello world就行</p>
<h3 id="1-DLL注入"><a href="#1-DLL注入" class="headerlink" title="1.DLL注入"></a>1.DLL注入</h3><p><strong>流程</strong><br>1.提权到控制目标进程所需的权限，一般情况下管理员权限足够。</p>
<p>2.根据目标进程的pid使用OpenProcess函数得到进程句柄。</p>
<p>3.根据进程句柄在目标进程中申请内存VirtualAllocEx</p>
<p>4.在目标进程中刚刚申请的内存空间中写入所需参数(Dll的完整路径)WriteProcessMemory</p>
<p>5.加载kernal32.dll，并用GetProcAddress得到LoadLibraryW的模块加载地址，kernel32的导出函数在所有进程中的映射地址都一样，因此我们可以通过在当前进程中查询LoadLibrary函数的地址来得到所有进程中LoadLibraryW函数的地址。</p>
<p>6.启动远程线程CreateRemoteThread，并传入第五步获得的LoadLibrary函数地址与之前用VirtualAllocEX函数申请的地址，调用注入的dll。<br><strong>写一个dll</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY DllMain( HMODULE hModule,</span><br><span class="line">                       DWORD  ul_reason_for_call,</span><br><span class="line">                       LPVOID lpReserved</span><br><span class="line">                     )</span><br><span class="line">&#123;</span><br><span class="line">    switch (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    case DLL_PROCESS_ATTACH:    </span><br><span class="line">        MessageBox(NULL, TEXT(&quot;DLL_PROCESS_ATTACH&quot;), TEXT(&quot;成功了&quot;), NULL);</span><br><span class="line">        break;</span><br><span class="line">    case DLL_THREAD_ATTACH:</span><br><span class="line">		MessageBox(NULL, TEXT(&quot;DLL_THREAD_ATTACH&quot;), TEXT(&quot;成功了&quot;), NULL);</span><br><span class="line">		break;</span><br><span class="line">    case DLL_THREAD_DETACH:</span><br><span class="line">		MessageBox(NULL, TEXT(&quot;DLL_THREAD_DETACH&quot;), TEXT(&quot;成功了&quot;), NULL);</span><br><span class="line">		break;</span><br><span class="line">    case DLL_PROCESS_DETACH:</span><br><span class="line">		MessageBox(NULL, TEXT(&quot;DLL_PROCESS_DETACH&quot;), TEXT(&quot;成功了&quot;), NULL);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    return TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2022/11/24/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E9%9A%90%E8%94%BD%E7%9A%84%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%90%AF%E5%8A%A8-%E5%B8%A6%E5%AE%9E%E9%AA%8C/image-20221124114657979.png" alt="image-20221124114657979"></p>
<h2 id="二、使用Detours实现IAT-HOOK和Inline-HOOK。"><a href="#二、使用Detours实现IAT-HOOK和Inline-HOOK。" class="headerlink" title="二、使用Detours实现IAT HOOK和Inline HOOK。"></a>二、使用Detours实现IAT HOOK和Inline HOOK。</h2><h2 id="三、使用SetWindowsHookEx完成全局钩子和线程钩子"><a href="#三、使用SetWindowsHookEx完成全局钩子和线程钩子" class="headerlink" title="三、使用SetWindowsHookEx完成全局钩子和线程钩子"></a>三、使用SetWindowsHookEx完成全局钩子和线程钩子</h2><p>要求：<br>（1） IAT HOOK和Inline HOOK至少对一个API函数进行挂钩，然后实现自定义的函数功能；<br>（2）全局钩子需要将自己设计的Dll注入到其他进程；<br>（3）需要提交源代码和效果图展示；<br>（4）作业提交时间：2022年12月18日。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/11/21/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/%E9%98%B2%E7%81%AB%E5%A2%99/" rel="next" title="防火墙">
                <i class="fa fa-chevron-left"></i> 防火墙
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/12/08/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/%E5%AF%B9%E6%8A%97%E5%8F%8D%E6%B1%87%E7%BC%96/" rel="prev" title="对抗反汇编">
                对抗反汇编 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E5%90%AF%E5%8A%A8%E5%99%A8%EF%BC%88Launcher%EF%BC%89"><span class="nav-text">1 启动器（Launcher）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5"><span class="nav-text">2 进程注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-DLL-%E6%B3%A8%E5%85%A5"><span class="nav-text">2.1 DLL 注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E7%9B%B4%E6%8E%A5%E6%B3%A8%E5%85%A5"><span class="nav-text">2.2 直接注入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E8%BF%9B%E7%A8%8B%E6%9B%BF%E6%8D%A2"><span class="nav-text">3 进程替换</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E9%92%A9%E5%AD%90%EF%BC%88Hook%EF%BC%89%E6%B3%A8%E5%85%A5"><span class="nav-text">4 钩子（Hook）注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1%E9%92%A9%E5%AD%90%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-text">4.1钩子的分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%BA%BF%E7%A8%8B%E9%92%A9%E5%AD%90%EF%BC%88Hook%EF%BC%89"><span class="nav-text">4.2 系统和线程钩子（Hook）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E4%BD%BF%E7%94%A8%E9%92%A9%E5%AD%90%E7%9A%84%E9%94%AE%E7%9B%98%E8%AE%B0%E5%BD%95%E5%99%A8"><span class="nav-text">4.3 使用钩子的键盘记录器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-%E4%BD%BF%E7%94%A8SetWindowsHookEx"><span class="nav-text">4.4 使用SetWindowsHookEx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-%E7%9B%AE%E6%A0%87%E7%BA%BF%E7%A8%8B"><span class="nav-text">4.5 目标线程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-Detours"><span class="nav-text">5 Detours</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-APC-%E6%B3%A8%E5%85%A5"><span class="nav-text">6 APC 注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-APC%E6%B3%A8%E5%85%A5%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8FAPC%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="nav-text">6.1 APC注入用户模式APC注入流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E5%86%85%E6%A0%B8%E6%A8%A1%E5%BC%8F%E7%9A%84APC-%E6%B3%A8%E5%85%A5"><span class="nav-text">6.2 内核模式的APC 注入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%B3%E6%97%B6%E4%BD%9C%E4%B8%9A"><span class="nav-text">平时作业</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%9F%A5%E9%98%85%E8%B5%84%E6%96%99%EF%BC%8C%E5%AE%9E%E7%8E%B0%E7%9B%B4%E6%8E%A5%E6%B3%A8%E5%85%A5%E5%92%8CDLL%E6%B3%A8%E5%85%A5%E3%80%82"><span class="nav-text">一、查阅资料，实现直接注入和DLL注入。</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-DLL%E6%B3%A8%E5%85%A5"><span class="nav-text">1.DLL注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8Detours%E5%AE%9E%E7%8E%B0IAT-HOOK%E5%92%8CInline-HOOK%E3%80%82"><span class="nav-text">二、使用Detours实现IAT HOOK和Inline HOOK。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8SetWindowsHookEx%E5%AE%8C%E6%88%90%E5%85%A8%E5%B1%80%E9%92%A9%E5%AD%90%E5%92%8C%E7%BA%BF%E7%A8%8B%E9%92%A9%E5%AD%90"><span class="nav-text">三、使用SetWindowsHookEx完成全局钩子和线程钩子</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LUOSY</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
